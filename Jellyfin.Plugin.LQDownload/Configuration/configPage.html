<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>LQ Download</title>
	</head>
	<body>
		<div data-role="page" class="page type-interior pluginConfigurationPage LQDownloadConfigPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
			<div data-role="content">
				<div class="content-primary">
					<form class="LQDownloadConfigForm">
						<div class="selectContainer">
							<label class="selectLabel" for="Resolution">Select Resolution</label>
							<select is="emby-select" id="Resolution" name="Resolution" class="emby-select-withcolor emby-select">
								<option id="optResolution1080p" value="Resolution1080p">Resolution1080p</option>
								<option id="optResolution720p" value="Resolution720p">Resolution720p</option>
								<option id="optResolution480p" value="Resolution480p">Resolution480p</option>
							</select>
						</div>
						<div class="inputContainer">
							<label class="inputLabel inputLabelUnfocused" for="MaxBitrate">Max Bitrate (kbps)</label>
							<input id="MaxBitrate" name="MaxBitrate" type="number" is="emby-input" min="0" />
							<div class="fieldDescription">Recommended: 4000 kbps for Resolution1080p, 2500 kbps for Resolution720p, 1000 kbps for Resolution480p</div>
						</div>
						<div>
							<button is="emby-button" type="submit" class="raised button-submit block emby-button">
								<span>Save</span>
							</button>
						</div>
					</form>
				</div>
			</div>
			<script type="text/javascript">
				var LQDownloadConfig = {
					pluginUniqueId: "8cdb7e71-66fc-42e1-b821-c37cab2451b6",
				};

				var DEFAULT_RESOLUTION = "Resolution1080p";
				var DEFAULT_MAXBITRATE = 4000;

				$(".LQDownloadConfigPage").on("pageshow", function () {
					Dashboard.showLoadingMsg();
					var page = this;
					ApiClient.getPluginConfiguration(LQDownloadConfig.pluginUniqueId).then(function (config) {
						console.log("LQDOWNLOAD: config", config);
						console.log("LQDOWNLOAD: #Resolution", page.querySelector("#Resolution"));
						console.log("LQDOWNLOAD: #MaxBitrate", page.querySelector("#MaxBitrate"));
						$("#Resolution", page)
							.val(config.Resolution || DEFAULT_RESOLUTION)
							.change();
						$("#MaxBitrate", page)
							.val(config.MaxBitrate || DEFAULT_MAXBITRATE)
							.change();
						Dashboard.hideLoadingMsg();
					});
				});

				$(".LQDownloadConfigForm").on("submit", function () {
					Dashboard.showLoadingMsg();
					var form = this;

					let maxBitrate = $("#MaxBitrate").val();
					if (maxBitrate < 0) maxBitrate = DEFAULT_MAXBITRATE;

					ApiClient.getPluginConfiguration(LQDownloadConfig.pluginUniqueId).then(function (config) {
						config.Resolution = $("#Resolution", form).val();
						config.MaxBitrate = maxBitrate;
						ApiClient.updatePluginConfiguration(LQDownloadConfig.pluginUniqueId, config).then(Dashboard.processPluginConfigurationUpdateResult);
					});

					return false;
				});
			</script>
		</div>
	</body>
</html>
