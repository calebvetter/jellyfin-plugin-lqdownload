{
	// Paths and plugin name are configured in settings.json
	"version": "2.0.0",
	"tasks": [
		{
			// A chain task - build the plugin, then copy it to your
			// jellyfin server's plugin directory
			"label": "build-and-copy",
			"dependsOrder": "sequence",
			"dependsOn": ["build", "make-plugin-dir", "copy-dll"]
		},
		{
			// Build the plugin
			"label": "build",
			"command": "dotnet",
			"type": "shell",
			"args": ["publish", "${workspaceFolder}/${config:pluginNamespace}.sln", "-c", "Debug", "/property:GenerateFullPaths=true", "/consoleloggerparameters:NoSummary"],
			"group": "build",
			"presentation": {
				"reveal": "silent"
			},
			"problemMatcher": "$msCompile"
		},
		{
			// Ensure the plugin directory exists before trying to use it
			"label": "make-plugin-dir",
			"type": "shell",
			"command": "mkdir",
			"windows": {
				"args": ["-Force", "-Path", "${config:jellyfinWindowsDataDir}/plugins/${config:pluginNamespace}/"]
			},
			"linux": {
				"args": ["-p", "${config:jellyfinLinuxDataDir}/plugins/${config:pluginNamespace}/"]
			}
		},
		{
			// Copy the plugin dll to the jellyfin plugin install path
			// This command copies every .dll from the build directory to the plugin dir
			// Usually, you probablly only need ${config:pluginNamespace}.dll
			// But some plugins may bundle extra requirements
			"label": "copy-dll",
			"type": "shell",
			"command": "cp",
			"windows": {
				"args": ["./${config:pluginNamespace}/bin/Debug/net8.0/publish/${config:pluginNamespace}.dll", "${config:jellyfinWindowsDataDir}/plugins/${config:pluginNamespace}/"]
			},
			"linux": {
				"args": ["-r", "./${config:pluginNamespace}/bin/Debug/net8.0/publish/${config:pluginNamespace}.dll", "${config:jellyfinLinuxDataDir}/plugins/${config:pluginNamespace}/"]
			}
		}
	]
}
